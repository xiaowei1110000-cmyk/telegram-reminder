name: ä¿æŒæ´»è·ƒ

on:
  schedule:
    - cron: '*/10 * * * *'   # æ¯10åˆ†é’Ÿè¿è¡Œä¸€æ¬¡
  workflow_dispatch:         # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  ping:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      
    steps:
      - name: ğŸ”” å”¤é†’å®šæ—¶æé†’ç³»ç»Ÿ
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "========================================="
          echo "â° æ´»è·ƒå”¤é†’æœåŠ¡"
          echo "æ—¶é—´: $(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')"
          echo "ä»“åº“: ${{ github.repository }}"
          echo "========================================="
          
          # å‘é€å”¤é†’ä¿¡å·
          RESPONSE=$(curl -s -L -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/${{ github.repository }}/dispatches \
            -d '{"event_type":"ping"}' \
            -w "%{http_code}" \
            -o /dev/null)
          
          if [ "$RESPONSE" == "204" ]; then
            echo "âœ… å”¤é†’ä¿¡å·å‘é€æˆåŠŸ (HTTP 204)"
          else
            echo "âš ï¸ å”¤é†’ä¿¡å·å‘é€å¤±è´¥ (HTTP $RESPONSE)"
          fi
          
          echo "========================================="
          echo "âœ… ä¿æŒæ´»è·ƒä»»åŠ¡å®Œæˆ"
          echo "========================================="
