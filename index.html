<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>âœ… ä¸€é”®æµ‹è¯•Token</title>
</head>
<body style="font-family: system-ui; padding: 30px; max-width: 800px;">
    <h1 style="color: #2563eb;">ğŸ”§ GitHub Token ä¸€é”®æµ‹è¯•</h1>
    
    <div style="background: #f3f4f6; padding: 20px; border-radius: 12px;">
        <div style="margin-bottom: 15px;">
            <div style="font-weight: bold; margin-bottom: 5px;">ğŸ‘¤ ç”¨æˆ·å</div>
            <input id="username" value="xiaowei1110000-cmyk" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
        </div>
        
        <div style="margin-bottom: 15px;">
            <div style="font-weight: bold; margin-bottom: 5px;">ğŸ“¦ ä»“åº“å</div>
            <input id="repo" value="telegram-reminder" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="font-weight: bold; margin-bottom: 5px;">ğŸ”‘ Token</div>
            <input id="token" type="password" placeholder="ç²˜è´´æ‚¨åˆšå¤åˆ¶çš„ Token..." style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-family: monospace;">
        </div>
        
        <button onclick="testToken()" style="background: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer;">
            ğŸš€ ç«‹å³æµ‹è¯• Token
        </button>
    </div>
    
    <div id="result" style="margin-top: 30px; background: #1e293b; color: #e2e8f0; padding: 20px; border-radius: 12px; font-family: monospace; white-space: pre-wrap; min-height: 100px;">
        ç­‰å¾…æµ‹è¯•...
    </div>

    <script>
    async function testToken() {
        const username = document.getElementById('username').value.trim();
        const repo = document.getElementById('repo').value.trim();
        const token = document.getElementById('token').value.trim();
        
        if (!token) {
            alert('âŒ è¯·å…ˆç²˜è´´ Tokenï¼');
            return;
        }
        
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = 'â³ æ­£åœ¨éªŒè¯ Token...';
        
        try {
            // æµ‹è¯•1: è¯»å–ä»“åº“ä¿¡æ¯ï¼ˆéœ€è¦è®¤è¯ï¼‰
            const url = `https://api.github.com/repos/${username}/${repo}`;
            const res = await fetch(url, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            
            if (!res.ok) {
                const err = await res.json();
                throw new Error(err.message);
            }
            
            const data = await res.json();
            
            // æµ‹è¯•2: è¯»å– reminders.jsonï¼ˆæµ‹è¯•å†™æƒé™ï¼‰
            const contentUrl = `https://api.github.com/repos/${username}/${repo}/contents/reminders.json`;
            const contentRes = await fetch(contentUrl, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            
            let fileStatus = '';
            if (contentRes.status === 404) {
                fileStatus = 'ğŸ“ reminders.json ä¸å­˜åœ¨ï¼ˆæ­£å¸¸ï¼Œé¦–æ¬¡è¿è¡Œï¼‰';
            } else if (contentRes.ok) {
                fileStatus = 'âœ… å¯ä»¥è¯»å– reminders.json';
            } else {
                fileStatus = 'âš ï¸ è¯»å–å¤±è´¥: ' + contentRes.status;
            }
            
            // æµ‹è¯•3: è§¦å‘ Actionsï¼ˆæµ‹è¯• workflow æƒé™ï¼‰
            const actionUrl = `https://api.github.com/repos/${username}/${repo}/actions/workflows`;
            const actionRes = await fetch(actionUrl, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            
            let actionStatus = '';
            if (actionRes.ok) {
                const actionData = await actionRes.json();
                const hasWorkflow = actionData.total_count > 0;
                actionStatus = hasWorkflow ? 'âœ… å¯ä»¥è§¦å‘ Actions' : 'â„¹ï¸ ä»“åº“æš‚æ— å·¥ä½œæµæ–‡ä»¶';
            } else {
                actionStatus = 'âš ï¸ è·å–å·¥ä½œæµåˆ—è¡¨å¤±è´¥';
            }
            
            // æ˜¾ç¤ºç»“æœ
            resultDiv.innerHTML = `âœ…âœ…âœ… Token éªŒè¯æˆåŠŸï¼\n\n` +
                `ğŸ“Œ ä»“åº“: ${data.full_name}\n` +
                `ğŸ‘‘ æƒé™: ${data.permissions ? 'ç®¡ç†å‘˜æƒé™' : 'è¯»å†™æƒé™'}\n` +
                `${fileStatus}\n` +
                `${actionStatus}\n\n` +
                `ğŸ‰ è¿™ä¸ª Token å®Œå…¨å¯ç”¨ï¼ç°åœ¨æ‚¨å¯ä»¥ï¼š\n` +
                `1. å…³é—­è¿™ä¸ªæµ‹è¯•é¡µé¢\n` +
                `2. æ‰“å¼€æ‚¨çš„æé†’ç³»ç»Ÿé¡µé¢\n` +
                `3. ç²˜è´´è¿™ä¸ª Token\n` +
                `4. ç‚¹å‡»"ä¿å­˜é…ç½®"\n` +
                `5. ç‚¹å‡»"ä¿å­˜åˆ°GitHub"\n\n` +
                `ğŸ’¾ å»ºè®®ï¼šæŠŠè¿™ä¸ª Token ä¿å­˜åˆ°å¯†ç ç®¡ç†å™¨`;
            
            // è‡ªåŠ¨ä¿å­˜åˆ° localStorage
            localStorage.setItem('github_token', token);
            localStorage.setItem('github_username', username);
            localStorage.setItem('github_repo', repo);
            
        } catch (error) {
            resultDiv.innerHTML = `âŒâŒâŒ Token æ— æ•ˆï¼\n\n` +
                `é”™è¯¯: ${error.message}\n\n` +
                `å¯èƒ½çš„åŸå› ï¼š\n` +
                `1. Token å¤åˆ¶ä¸å®Œæ•´ï¼ˆå°‘äº†å­—ç¬¦ï¼‰\n` +
                `2. Token å·²è¿‡æœŸï¼ˆæ‚¨çš„æœ‰æ•ˆæœŸåˆ°3æœˆ13ï¼‰\n` +
                `3. æƒé™ä¸è¶³ï¼ˆä½†æ‚¨æˆªå›¾æ˜¾ç¤ºå·²å‹¾é€‰ repoï¼‰\n\n` +
                `âœ… è§£å†³æ–¹æ¡ˆï¼š\n` +
                `1. é‡æ–°å¤åˆ¶ Tokenï¼Œç¡®ä¿å®Œå…¨\n` +
                `2. æˆ–è€…ç‚¹å‡» "Regenerate token" é‡æ–°ç”Ÿæˆ`;
        }
    }
    </script>
</body>
</html>
