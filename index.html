<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub定时提醒系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        header { background: linear-gradient(135deg, #0088cc, #005a8c); color: white; padding: 25px; text-align: center; }
        .content { padding: 25px; }
        .section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; }
        h2 { color: #0088cc; margin-bottom: 20px; }
        input, textarea, button { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        button { background: #0088cc; color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        button:hover { background: #005a8c; }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: #333; }
        .btn-danger { background: #dc3545; }
        .notification { padding: 15px; border-radius: 5px; margin: 10px 0; display: flex; align-items: center; gap: 10px; }
        .success { background: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fab fa-telegram"></i> Telegram定时提醒系统</h1>
            <p>基于GitHub Actions，无需服务器</p>
        </header>
        
        <div class="content">
            <div id="notificationArea"></div>
            
            <div class="section">
                <h2><i class="fas fa-cog"></i> 基本配置</h2>
                <p>你的GitHub仓库地址：</p>
                <input type="text" id="repoUrl" placeholder="https://api.github.com/repos/用户名/仓库名">
                <button onclick="testConnection()"><i class="fas fa-plug"></i> 测试连接</button>
            </div>
            
            <div class="section">
                <h2><i class="fas fa-plus-circle"></i> 添加提醒</h2>
                <input type="text" id="reminderName" placeholder="提醒名称（例如：网宿IP）">
                <input type="date" id="lastUpdated">
                <input type="number" id="reminderDays" value="3" placeholder="间隔天数">
                <button onclick="addReminder()" class="btn-success"><i class="fas fa-plus"></i> 添加提醒</button>
            </div>
            
            <div class="section">
                <h2><i class="fas fa-list"></i> 提醒列表</h2>
                <div id="reminderList"></div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="saveToGitHub()" class="btn-success"><i class="fas fa-cloud-upload-alt"></i> 保存到GitHub</button>
                    <button onclick="testTelegram()" class="btn-warning"><i class="fas fa-paper-plane"></i> 测试发送</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let reminders = [];
        let githubRepo = '';
        
        // 设置今天日期
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('lastUpdated').valueAsDate = new Date();
            loadFromLocalStorage();
            updateReminderList();
        });
        
        // 测试GitHub连接
        async function testConnection() {
            const url = document.getElementById('repoUrl').value.trim();
            if (!url) {
                showNotification('请输入GitHub仓库地址', 'error');
                return;
            }
            
            showNotification('正在测试GitHub连接...', 'info');
            
            try {
                const response = await fetch(url);
                if (response.ok) {
                    githubRepo = url;
                    showNotification('✅ GitHub连接成功！', 'success');
                } else {
                    showNotification('❌ GitHub连接失败，请检查地址', 'error');
                }
            } catch (error) {
                showNotification(`❌ 连接失败: ${error.message}`, 'error');
            }
        }
        
        // 添加提醒
        function addReminder() {
            const name = document.getElementById('reminderName').value.trim();
            const lastUpdated = document.getElementById('lastUpdated').value;
            const days = parseInt(document.getElementById('reminderDays').value);
            
            if (!name) {
                showNotification('请输入提醒名称', 'error');
                return;
            }
            
            if (!lastUpdated) {
                showNotification('请选择日期', 'error');
                return;
            }
            
            if (!days || days < 1) {
                showNotification('间隔天数必须大于0', 'error');
                return;
            }
            
            const reminder = {
                id: Date.now(),
                name: name,
                lastUpdated: lastUpdated,
                days: days,
                createdAt: new Date().toISOString()
            };
            
            reminders.push(reminder);
            saveToLocalStorage();
            updateReminderList();
            
            // 清空表单
            document.getElementById('reminderName').value = '';
            document.getElementById('reminderDays').value = '3';
            document.getElementById('lastUpdated').valueAsDate = new Date();
            
            showNotification(`✅ "${name}" 已添加到提醒列表`, 'success');
        }
        
        // 删除提醒
        function deleteReminder(id) {
            if (confirm('确定要删除这个提醒吗？')) {
                reminders = reminders.filter(r => r.id !== id);
                saveToLocalStorage();
                updateReminderList();
                showNotification('✅ 提醒已删除', 'success');
            }
        }
        
        // 更新提醒列表显示
        function updateReminderList() {
            const list = document.getElementById('reminderList');
            
            if (reminders.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:#666;">暂无提醒项目</p>';
                return;
            }
            
            let html = '';
            reminders.forEach(r => {
                const nextDate = new Date(r.lastUpdated);
                nextDate.setDate(nextDate.getDate() + r.days);
                const nextStr = nextDate.toLocaleDateString('zh-CN');
                
                html += `
                    <div style="background:white; padding:15px; margin:10px 0; border-radius:8px; border-left:4px solid #0088cc;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <h4 style="margin:0 0 5px 0;">${r.name}</h4>
                                <div style="font-size:14px; color:#666;">
                                    上次: ${r.lastUpdated} | 间隔: ${r.days}天 | 下次: ${nextStr}
                                </div>
                            </div>
                            <button onclick="deleteReminder(${r.id})" style="background:#dc3545; padding:8px 12px; font-size:14px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            list.innerHTML = html;
        }
        
        // 保存到GitHub
        async function saveToGitHub() {
            if (!githubRepo) {
                showNotification('❌ 请先测试GitHub连接', 'error');
                return;
            }
            
            showNotification('正在准备数据...', 'info');
            
            const jsonData = JSON.stringify(reminders, null, 2);
            
            const guide = `
                <strong>请手动保存到GitHub：</strong><br>
                1. 复制下面的JSON数据<br>
                2. 访问你的GitHub仓库：${githubRepo.replace('api.github.com/repos', 'github.com')}<br>
                3. 点击 reminders.json 文件<br>
                4. 点击编辑按钮（✏️）<br>
                5. 粘贴JSON数据<br>
                6. 点击 Commit changes
            `;
            
            showNotification(guide, 'info');
            
            // 显示JSON数据
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.className = 'notification info';
                notification.innerHTML = `
                    <i class="fas fa-code"></i>
                    <div>
                        <strong>提醒数据JSON：</strong><br>
                        <textarea style="width:100%; height:100px; margin-top:10px; padding:10px; border:1px solid #ccc; border-radius:5px; font-family:monospace;" readonly>${jsonData}</textarea>
                        <button onclick="copyToClipboard('${jsonData.replace(/\n/g, '\\n').replace(/"/g, '\\"')}')" style="margin-top:5px; padding:5px 10px; background:#007bff; color:white; border:none; border-radius:3px; cursor:pointer;">
                            复制到剪贴板
                        </button>
                    </div>
                `;
                document.getElementById('notificationArea').appendChild(notification);
            }, 500);
        }
        
        // 测试Telegram发送
        function testTelegram() {
            if (!githubRepo) {
                showNotification('❌ 请先配置GitHub仓库', 'error');
                return;
            }
            
            const actionsUrl = githubRepo.replace('api.github.com/repos', 'github.com') + '/actions';
            
            const guide = `
                <strong>手动测试步骤：</strong><br>
                1. 访问：<a href="${actionsUrl}" target="_blank">${actionsUrl}</a><br>
                2. 在左侧找到 "Send Telegram Reminder"<br>
                3. 点击 "Run workflow" 按钮<br>
                4. 选择分支 "main"<br>
                5. 点击绿色 "Run workflow" 按钮<br>
                6. 等待运行完成（约30秒）<br>
                7. 检查Telegram群组是否收到消息
            `;
            
            showNotification(guide, 'info');
        }
        
        // 保存到本地存储
        function saveToLocalStorage() {
            localStorage.setItem('telegramReminders', JSON.stringify(reminders));
        }
        
        // 从本地存储加载
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('telegramReminders');
            if (saved) {
                try {
                    reminders = JSON.parse(saved);
                } catch (e) {
                    reminders = [];
                }
            }
        }
        
        // 复制到剪贴板
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('✅ 已复制到剪贴板！', 'success');
            });
        }
        
        // 显示通知
        function showNotification(message, type) {
            const notificationArea = document.getElementById('notificationArea');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'fas fa-info-circle';
            if (type === 'success') icon = 'fas fa-check-circle';
            if (type === 'error') icon = 'fas fa-exclamation-circle';
            
            notification.innerHTML = `<i class="${icon}"></i><div>${message}</div>`;
            notificationArea.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode === notificationArea) {
                    notificationArea.removeChild(notification);
                }
            }, 5000);
        }
        
        // 导出函数到全局
        window.deleteReminder = deleteReminder;
        window.copyToClipboard = copyToClipboard;
    </script>
</body>
</html>
